<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è - –û—Ñ—Ç–∞–ª—å–º–æ–≠–∫—Å–ø–µ—Ä—Ç</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –≤—ã—Å–æ—Ç—ã —Ç–∞–±–ª–∏—Ü—ã —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π */
        .table-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 4px;
        }
        
        .table-container table {
            margin-bottom: 0;
        }
        
        .table-container thead th {
            position: sticky;
            top: 0;
            background: #f8f9fa;
            z-index: 10;
        }
        
        /* –£–º–µ–Ω—å—à–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–Ω–æ–ø–æ–∫ */
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        /* –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã –≤ —è—á–µ–π–∫–∞—Ö */
        .compact-table td {
            padding: 0.5rem;
        }
        
        /* –ö–æ–º–ø–∞–∫—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
        .action-buttons {
            display: flex;
            gap: 4px;
            flex-wrap: nowrap;
        }
        
        /* –ï–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤ action-card */
        .action-card .btn {
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
        }
    </style>
</head>

<body class="dashboard-page">
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="navbar-content">
                <a href="{{ url_for('index') }}" class="logo logo-link">
                    <span class="logo-icon">üëÅÔ∏è</span>
                    <span class="logo-text">–û—Ñ—Ç–∞–ª—å–º–æ–≠–∫—Å–ø–µ—Ä—Ç</span>
                </a>
                <div class="nav-links">
                    <a href="{{ url_for('dashboard') }}" class="nav-link active">–ì–ª–∞–≤–Ω–∞—è</a>
                    <a href="{{ url_for('patient_list') }}" class="nav-link">–ü–∞—Ü–∏–µ–Ω—Ç—ã</a>
                    <a href="{{ url_for('consultation') }}" class="nav-link">–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</a>
                    <div class="user-menu">
                        <a href="{{ url_for('profile') }}" class="user-name" id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</a>
                        <a href="{{ url_for('logout') }}" class="btn btn-sm btn-secondary">–í—ã–π—Ç–∏</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container main-content">
        <!-- Page Header -->
        <div class="page-header">
            <div class="header-content">
                <h1>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h1>
                <p class="text-muted" id="welcomeMessage">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</p>
            </div>
            
        </div>

        <!-- Quick Actions -->
        <div class="grid grid-2">
            <div class="action-card">
                <div class="action-content">
                    <h3>–ù–æ–≤—ã–π –ø–∞—Ü–∏–µ–Ω—Ç</h3>
                    <p class="text-muted">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –≤ —Å–∏—Å—Ç–µ–º—É</p>
                    <a href="{{ url_for('patient_new') }}" class="btn btn-secondary btn-sm">
                        –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–∞
                    </a>
                </div>
            </div>

            <div class="action-card">
                <div class="action-content">
                    <h3>–ù–æ–≤–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</h3>
                    <p class="text-muted">–ù–∞—á–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É </p>
                    <a href="{{ url_for('consultation') }}" class="btn btn-secondary btn-sm">
                        –ù–∞—á–∞—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é
                    </a>
                </div>
            </div>
        </div>

        <!-- Recent Patients -->
        <div class="card">
            <div class="card-header">
                <div class="card-header-content">
                    <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç—ã</h2>
                    <a href="{{ url_for('patient_list') }}" class="btn btn-sm btn-secondary">
                        –í—Å–µ –ø–∞—Ü–∏–µ–Ω—Ç—ã ‚Üí
                    </a>
                </div>
            </div>
            <div class="card-content">
                {% if patients %}
                <div class="table-container">
                    <table class="table compact-table">
                        <thead>
                            <tr>
                                <!-- <th>ID</th>-->
                                <th>–§–ò–û</th>
                                <th>–í–æ–∑—Ä–∞—Å—Ç</th>
                                <th>–ü–æ–ª</th>
                                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                <th>EMAIL</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for patient in patients[-3:]|reverse %}
                            <tr>
                                <!-- <td>#{{ patient.id }}</td>-->
                                <td>
                                    <div class="patient-info">
                                        <strong>{{ patient.last_name }} {{ patient.first_name }} {{ patient.middle_name or '' }}</strong>
                                        {% if patient.email %}
                                        <span class="text-muted text-sm">{{ patient.email }}</span>
                                        {% endif %}
                                    </div>
                                </td>
                                <td>
                                    {% if patient.age %}
                                        {{ patient.age }}
                                        {% set age = patient.age %}
                                        {% if age % 10 == 1 and age % 100 != 11 %}
                                            –≥–æ–¥
                                        {% elif age % 10 >= 2 and age % 10 <= 4 and (age % 100 < 10 or age % 100 >= 20) %}
                                            –≥–æ–¥–∞
                                        {% else %}
                                            –ª–µ—Ç
                                        {% endif %}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>{{ '–ú—É–∂—Å–∫–æ–π' if patient.sex == 'M' else '–ñ–µ–Ω—Å–∫–∏–π' }}</td>
                                <td>{{ patient.phone or '-' }}</td>
                                <td>{{ patient.email or '-' }}</td>
                                <td>
                                    <div class="action-buttons">
                                        <a href="{{ url_for('patient_history', patient_id=patient.id) }}"
                                            class="btn btn-sm btn-secondary">
                                            –ò—Å—Ç–æ—Ä–∏—è
                                        </a>
                                        <a href="{{ url_for('consultation', patient_id=patient.id) }}"
                                            class="btn btn-sm btn-primary">
                                            –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% if patients|length > 3 %}
                <div class="text-center mt-3">
                    <small class="text-muted">–ü–æ–∫–∞–∑–∞–Ω–æ 3 –∏–∑ {{ patients|length }} –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</small>
                </div>
                {% endif %}
                {% else %}
                <div class="empty-state">
                    <h3>–°–ø–∏—Å–æ–∫ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –ø—É—Å—Ç</h3>
                    <p class="text-muted">–í —Å–∏—Å—Ç–µ–º–µ –ø–æ–∫–∞ –Ω–µ—Ç –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É.</p>
                    <a href="{{ url_for('patient_new') }}" class="btn btn-primary btn-sm">
                        –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–∞
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Recent Consultations -->
        <div class="card">
            <div class="card-header">
                <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</h2>
            </div>
            <div class="card-content">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–ü–∞—Ü–∏–µ–Ω—Ç</th>
                                <th>–°–∏–º–ø—Ç–æ–º—ã</th>
                                <th>–î–∏–∞–≥–Ω–æ–∑</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>20.01.2024</td>
                                <td>–ü–µ—Ç—Ä–æ–≤ –ò–≤–∞–Ω –°–µ—Ä–≥–µ–µ–≤–∏—á</td>
                                <td>–ë–æ–ª—å, –ø–æ–∫—Ä–∞—Å–Ω–µ–Ω–∏–µ</td>
                                <td>–û—Å—Ç—Ä—ã–π –∫–æ–Ω—ä—é–Ω–∫—Ç–∏–≤–∏—Ç</td>
                                <td><span class="status-badge status-completed">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</span></td>
                                <td>
                                    <a href="{{ url_for('consultation_result') }}"
                                        class="btn btn-sm btn-secondary">–ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                                </td>
                            </tr>
                            <tr>
                                <td>19.01.2024</td>
                                <td>–°–∏–¥–æ—Ä–æ–≤–∞ –ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–Ω–∞</td>
                                <td>–£—Ö—É–¥—à–µ–Ω–∏–µ –∑—Ä–µ–Ω–∏—è</td>
                                <td>–ú–∏–æ–ø–∏—è</td>
                                <td><span class="status-badge status-completed">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</span></td>
                                <td>
                                    <a href="{{ url_for('consultation_result') }}"
                                        class="btn btn-sm btn-secondary">–ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
</body>

</html>